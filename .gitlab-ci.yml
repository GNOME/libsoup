image: fedora:28

variables:
  ADDITIONAL_DEPENDENCIES: which gtk-doc libpsl-devel make httpd php php-xmlrpc mod_ssl redhat-rpm-config
  USER: user

build_stable:
  before_script:
    - dnf update -y --nogpgcheck
    - dnf install -y 'dnf-command(builddep)'
    - dnf builddep -y --nogpgcheck libsoup
    - dnf install -y --nogpgcheck $ADDITIONAL_DEPENDENCIES
  script:
    - adduser $USER
    - su -c ./autogen.sh $USER
    - su -c make $USER
    - su -c 'make check' $USER
  artifacts:
    paths:
      - config.log
      - tests/test-suite.log
    when: on_failure
